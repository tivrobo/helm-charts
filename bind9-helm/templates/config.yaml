apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "bind9-helm.fullname" . }}-config
  labels:
    {{- include "bind9-helm.labels" . | nindent 4 }}
data:
  named.conf: |
    acl "trusted" {
    {{- range .Values.trusted }}
        {{ . }};
    {{- end }}
    };

    options {
      directory "/var/cache/bind";

      recursion yes;
      allow-query { any; };
      allow-query-cache { trusted; };
      allow-recursion { trusted; };

      forwarders {
    {{- range .Values.forwarders }}
        {{ . }};
    {{- end }}
      };
      forward only;

      dnssec-validation auto;

      auth-nxdomain no;
      listen-on-v6 { any; };

      empty-zones-enable no;
      querylog yes;
      version "latest";
    };

    {{- if .Values.zones }}
    {{- range .Values.zones }}
    zone "{{ .name }}" {
      type forward;
      forward only;
      forwarders {
    {{- range .forwarders }}
        {{ . }};
    {{- end }}
      };
    };
    {{- end }}
    {{- end }}
